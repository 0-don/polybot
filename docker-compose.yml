services:
  polybot-llm-leaderboard:
    container_name: polybot-llm-leaderboard
    depends_on:
      - polybot-db
    build:
      context: ./
      dockerfile: Dockerfile
      target: llm-leaderboard
    restart: always
    volumes:
      - ~/polybot-stream/:/app/stream
    environment:
      - DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}/${POSTGRES_DB}
    shm_size: "8gb"
  polybot-markets:
    container_name: polybot-markets
    depends_on:
      - polybot-db
    build:
      context: ./
      dockerfile: Dockerfile
      target: markets
    restart: always
    environment:
      - DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}/${POSTGRES_DB}
      - PK=${PK}
      - ALCHEMY_API_KEY=${ALCHEMY_API_KEY}
      - CLOB_API_KEY=${CLOB_API_KEY}
      - CLOB_SECRET=${CLOB_SECRET}
      - CLOB_PASS_PHRASE=${CLOB_PASS_PHRASE}
  polybot-db:
    container_name: polybot-db
    image: postgres:16-alpine
    restart: always
    ports:
      - 5436:5432
    environment:
      - POSTGRES_DB=${POSTGRES_DB}
      - POSTGRES_USER=${POSTGRES_USER}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
